(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{YanU:function(t,n,e){"use strict";e.r(n),e.d(n,"PostsModule",function(){return R});var s=e("ofXK"),o=e("3Pt+"),i=e("tyNb"),c=e("l7P3"),a=e("JC0d"),r=e("nSkL");async function b(t=0,n=5){const e=Math.min(t,n),s=~~((Math.random()+.4)*(300<<e));await new Promise(t=>setTimeout(n=>t(n),s))}const l=Object.assign((t,n)=>async(e,s,o)=>{const i={maxRetries:5,backoff:b,...n,...o};let c=0;for(;;)try{const n=await t(e,s,o);if(n.error)throw new r.a(n);return n}catch(a){if(c++,a.throwImmediately||c>i.maxRetries){if(a instanceof r.a)return a.value;throw a}await i.backoff(c,i.maxRetries)}},{fail:function(t){throw Object.assign(new r.a({error:t}),{throwImmediately:!0})}});var d=e("1bI8"),u=e("fXoL");const p=l(Object(a.a)({baseUrl:"/"}),{maxRetries:6}),f=Object(d.b)({reducerPath:"postsApi",baseQuery:p,entityTypes:["Posts"],endpoints:t=>({getPosts:t.query({query:()=>({url:"posts"}),provides:t=>[...t.map(({id:t})=>({type:"Posts",id:t})),{type:"Posts",id:"LIST"}]}),addPost:t.mutation({query:t=>({url:"posts",method:"POST",body:t}),invalidates:[{type:"Posts",id:"LIST"}]}),getPost:t.query({query:t=>`posts/${t}`,provides:(t,n)=>[{type:"Posts",id:n}]}),updatePost:t.mutation({query(t){const{id:n}=t;return{url:`posts/${n}`,method:"PUT",body:function(t,n){var e={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&n.indexOf(s)<0&&(e[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)n.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(e[s[o]]=t[s[o]])}return e}(t,["id"])}},invalidates:(t,{id:n})=>[{type:"Posts",id:n}]}),deletePost:t.mutation({query:t=>({url:`posts/${t}`,method:"DELETE"}),invalidates:(t,n)=>[{type:"Posts",id:n}]})})}),{useAddPostMutation:g,useDeletePostMutation:m,useGetPostQuery:y,useGetPostsQuery:h,useUpdatePostMutation:P}=f;let I=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=u.Hb({type:t}),t.\u0275inj=u.Gb({imports:[[c.i.forFeature(f.reducerPath,f.reducer,{metaReducers:[f.metareducer]})]]}),t})();function O(t,n){1&t&&(u.Ob(0,"small"),u.kc(1,"Loading..."),u.Nb())}const k=function(t){return["/posts",t]};function v(t,n){if(1&t&&(u.Ob(0,"li"),u.Ob(1,"a",6),u.kc(2),u.Nb(),u.Nb()),2&t){const t=n.$implicit;u.zb(1),u.ac("routerLink",u.cc(2,k,t.id)),u.zb(1),u.lc(t.name)}}function w(t,n){if(1&t&&(u.Ob(0,"div"),u.ic(1,v,3,4,"li",5),u.Nb()),2&t){const t=u.Xb().ngIf,n=u.Xb();u.zb(1),u.ac("ngForOf",t.posts)("ngForTrackBy",n.trackByFn)}}function N(t,n){1&t&&(u.Ob(0,"p",7),u.kc(1,"No posts :("),u.Nb())}function L(t,n){if(1&t&&(u.Ob(0,"section",1),u.ic(1,O,2,0,"small",2),u.ic(2,w,2,2,"div",3),u.ic(3,N,2,0,"ng-template",null,4,u.jc),u.Nb()),2&t){const t=n.ngIf,e=u.ec(4);u.zb(1),u.ac("ngIf",t.isLoading),u.zb(1),u.ac("ngIf",null==t.posts?null:t.posts.length)("ngIfElse",e)}}let z=(()=>{class t{constructor(){this.postsQuery$=h(void 0,{selectFromResult:({data:t,isLoading:n})=>({posts:t,isLoading:n})})}trackByFn(t,n){return n.id}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u.Db({type:t,selectors:[["app-posts-list"]],decls:2,vars:3,consts:[["class","space-y-4",4,"ngIf"],[1,"space-y-4"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["noPosts",""],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"hover:underline",3,"routerLink"],[1,"mt-4"]],template:function(t,n){1&t&&(u.ic(0,L,5,3,"section",0),u.Yb(1,"async")),2&t&&u.ac("ngIf",u.Zb(1,1,n.postsQuery$))},directives:[s.k,s.j,i.i],pipes:[s.b],encapsulation:2,changeDetection:0}),t})();function X(t,n){if(1&t){const t=u.Pb();u.Ob(0,"button",4),u.Vb("click",function(){return u.fc(t),u.Xb().addNewPost()}),u.kc(1),u.Nb()}if(2&t){const t=n.ngIf,e=u.Xb();u.ac("disabled",e.postNameFormControl.invalid||t.isLoading),u.zb(1),u.mc(" ",t.isLoading?"Adding...":"Add Post"," ")}}let j=(()=>{class t{constructor(){this.addPost=g(),this.postNameFormControl=new o.b("",[o.j.required])}addNewPost(){this.addPost.dispatch({name:this.postNameFormControl.value})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=u.Db({type:t,selectors:[["app-posts-manager"]],decls:12,vars:4,consts:[[1,"space-y-4"],["id","name","placeholder","New post name","type","text",3,"formControl"],["class","m-4 btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"text-xl","font-semibold"],[1,"m-4","btn","btn-primary",3,"disabled","click"]],template:function(t,n){1&t&&(u.Ob(0,"section",0),u.Ob(1,"div"),u.Kb(2,"input",1),u.ic(3,X,2,2,"button",2),u.Yb(4,"async"),u.Nb(),u.Ob(5,"h1",3),u.kc(6,"Posts List"),u.Nb(),u.Kb(7,"app-posts-list"),u.Kb(8,"hr"),u.Ob(9,"h1",3),u.kc(10,"Posts List with duplicate subscription"),u.Nb(),u.Kb(11,"app-posts-list"),u.Nb()),2&t&&(u.zb(2),u.ac("formControl",n.postNameFormControl),u.zb(1),u.ac("ngIf",u.Zb(4,2,n.addPost.state$)))},directives:[o.a,o.e,o.c,s.k,z],pipes:[s.b],encapsulation:2,changeDetection:0}),t})();var x=e("lJxs"),F=e("vkgz");function E(t,n){1&t&&(u.Ob(0,"small"),u.kc(1,"Loading..."),u.Nb())}function C(t,n){if(1&t){const t=u.Pb();u.Ob(0,"button",10),u.Vb("click",function(){return u.fc(t),u.Xb(4).toggleEdit()}),u.kc(1),u.Nb()}if(2&t){const t=n.ngIf,e=u.Xb().ngIf,s=u.Xb(2).ngIf;u.ac("disabled",s.isLoading||e.isLoading||t.isLoading),u.zb(1),u.mc(" ",null!=t&&t.isLoading?"Updating...":"Edit"," ")}}function M(t,n){if(1&t){const t=u.Pb();u.Ob(0,"div",8),u.ic(1,C,2,2,"button",9),u.Yb(2,"async"),u.Ob(3,"button",10),u.Vb("click",function(){u.fc(t);const n=u.Xb(2).ngIf;return u.Xb().deletePost(n.data)}),u.kc(4),u.Nb(),u.Ob(5,"button",10),u.Vb("click",function(){return u.fc(t),u.Xb(2).ngIf.refetch()}),u.kc(6," Refresh "),u.Nb(),u.Nb()}if(2&t){const t=n.ngIf,e=u.Xb(2).ngIf,s=u.Xb();u.zb(1),u.ac("ngIf",u.Zb(2,4,s.updatePostMutation.state$)),u.zb(2),u.ac("disabled",e.isLoading||t.isLoading),u.zb(1),u.mc(" ",null!=t&&t.isLoading?"Deleting...":"Delete"," "),u.zb(1),u.ac("disabled",e.isFetching)}}function $(t,n){if(1&t&&(u.Mb(0),u.ic(1,M,7,6,"div",7),u.Yb(2,"async"),u.Lb()),2&t){const t=u.Xb(2);u.zb(1),u.ac("ngIf",u.Zb(2,1,t.deletePostMutation.state$))}}function D(t,n){if(1&t){const t=u.Pb();u.Ob(0,"div",12),u.Kb(1,"input",13),u.Ob(2,"button",14),u.Vb("click",function(){u.fc(t);const n=u.Xb(2).ngIf;return u.Xb().updatePost(n.data)}),u.kc(3),u.Nb(),u.Ob(4,"button",14),u.Vb("click",function(){return u.fc(t),u.Xb(3).toggleEdit()}),u.kc(5,"Cancel"),u.Nb(),u.Nb()}if(2&t){const t=n.ngIf,e=u.Xb(3);u.zb(1),u.ac("formControl",e.postFormControl),u.zb(1),u.ac("disabled",t.isLoading),u.zb(1),u.mc(" ",null!=t&&t.isLoading?"Updating...":"Update"," "),u.zb(1),u.ac("disabled",t.isLoading)}}function T(t,n){if(1&t&&(u.ic(0,D,6,4,"div",11),u.Yb(1,"async")),2&t){const t=u.Xb(2);u.ac("ngIf",u.Zb(1,1,t.updatePostMutation.state$))}}function q(t,n){if(1&t&&(u.Ob(0,"section",1),u.Ob(1,"div"),u.Ob(2,"h1",2),u.kc(3),u.Nb(),u.ic(4,E,2,0,"small",3),u.Nb(),u.ic(5,$,3,3,"ng-container",4),u.ic(6,T,2,3,"ng-template",null,5,u.jc),u.Ob(8,"pre",6),u.kc(9),u.Yb(10,"json"),u.Nb(),u.Nb()),2&t){const t=n.ngIf,e=u.ec(7),s=u.Xb();u.zb(3),u.lc(null==t||null==t.data?null:t.data.name),u.zb(1),u.ac("ngIf",t.isFetching),u.zb(1),u.ac("ngIf",!s.isEditing)("ngIfElse",e),u.zb(4),u.lc(u.Zb(10,5,t.data))}}const Y=[{path:"",component:j},{path:":id",component:(()=>{class t{constructor(t,n){this.route=t,this.router=n,this.postQuery$=y(this.route.params.pipe(Object(x.a)(t=>+t.id))).pipe(Object(F.a)(t=>{var n,e;return this.postFormControl.setValue(null!==(e=null===(n=t.data)||void 0===n?void 0:n.name)&&void 0!==e?e:"")})),this.updatePostMutation=P(),this.deletePostMutation=m(),this.postFormControl=new o.b(""),this.isEditing=!1}updatePost({id:t}){this.updatePostMutation.dispatch({id:t,name:this.postFormControl.value}).unwrap().then(()=>this.toggleEdit())}deletePost({id:t}){this.deletePostMutation.dispatch(t).unwrap().then(()=>this.router.navigate(["/posts"])).catch(()=>console.log("Error deleting Post"))}toggleEdit(){this.isEditing=!this.isEditing}}return t.\u0275fac=function(n){return new(n||t)(u.Jb(i.a),u.Jb(i.g))},t.\u0275cmp=u.Db({type:t,selectors:[["app-post-detail"]],decls:2,vars:3,consts:[["class","space-y-4",4,"ngIf"],[1,"space-y-4"],[1,"text-xl","font-semibold"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["editionSection",""],[1,"bg-gray-200"],["class","flex items-center space-x-4",4,"ngIf"],[1,"flex","items-center","space-x-4"],["class","btn-outline btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn-outline","btn-primary",3,"disabled","click"],["class","space-x-4",4,"ngIf"],[1,"space-x-4"],["type","text",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(t,n){1&t&&(u.ic(0,q,11,7,"section",0),u.Yb(1,"async")),2&t&&u.ac("ngIf",u.Zb(1,1,n.postQuery$))},directives:[s.k,o.a,o.e,o.c],pipes:[s.b,s.f],encapsulation:2,changeDetection:0}),t})()}];let Q=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=u.Hb({type:t}),t.\u0275inj=u.Gb({imports:[[i.j.forChild(Y)],i.j]}),t})(),R=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=u.Hb({type:t}),t.\u0275inj=u.Gb({imports:[[s.c,Q,o.d,o.h,I]]}),t})()}}]);
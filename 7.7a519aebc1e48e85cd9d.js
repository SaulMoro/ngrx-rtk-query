(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{YanU:function(t,n,e){"use strict";e.r(n),e.d(n,"PostsModule",function(){return S});var s=e("ofXK"),o=e("3Pt+"),i=e("tyNb"),c=e("l7P3"),a=e("JC0d"),r=e("nSkL");async function b(t=0,n=5){const e=Math.min(t,n),s=~~((Math.random()+.4)*(300<<e));await new Promise(t=>setTimeout(n=>t(n),s))}const l=Object.assign((t,n)=>async(e,s,o)=>{const i={maxRetries:5,backoff:b,...n,...o};let c=0;for(;;)try{const n=await t(e,s,o);if(n.error)throw new r.a(n);return n}catch(a){if(c++,a.throwImmediately||c>i.maxRetries){if(a instanceof r.a)return a.value;throw a}await i.backoff(c,i.maxRetries)}},{fail:function(t){throw Object.assign(new r.a({error:t}),{throwImmediately:!0})}});var d=e("1bI8"),u=e("AytR"),p=e("fXoL");const f=l(Object(a.a)({baseUrl:u.a.baseApi}),{maxRetries:6}),g=Object(d.b)({reducerPath:"postsApi",baseQuery:f,entityTypes:["Posts"],endpoints:t=>({getPosts:t.query({query:()=>({url:"posts"}),provides:t=>[...t.map(({id:t})=>({type:"Posts",id:t})),{type:"Posts",id:"LIST"}]}),addPost:t.mutation({query:t=>({url:"posts",method:"POST",body:t}),invalidates:[{type:"Posts",id:"LIST"}]}),getPost:t.query({query:t=>`posts/${t}`,provides:(t,n)=>[{type:"Posts",id:n}]}),updatePost:t.mutation({query(t){const{id:n}=t;return{url:`posts/${n}`,method:"PUT",body:function(t,n){var e={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&n.indexOf(s)<0&&(e[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(t);o<s.length;o++)n.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o])&&(e[s[o]]=t[s[o]])}return e}(t,["id"])}},invalidates:(t,{id:n})=>[{type:"Posts",id:n}]}),deletePost:t.mutation({query:t=>({url:`posts/${t}`,method:"DELETE"}),invalidates:(t,n)=>[{type:"Posts",id:n}]})})}),{useAddPostMutation:m,useDeletePostMutation:y,useGetPostQuery:h,useGetPostsQuery:P,useUpdatePostMutation:I}=g;let O=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=p.Hb({type:t}),t.\u0275inj=p.Gb({imports:[[c.i.forFeature(g.reducerPath,g.reducer,{metaReducers:[g.metareducer]})]]}),t})();function k(t,n){1&t&&(p.Ob(0,"small"),p.kc(1,"Loading..."),p.Nb())}const v=function(t){return["/posts",t]};function w(t,n){if(1&t&&(p.Ob(0,"li"),p.Ob(1,"a",6),p.kc(2),p.Nb(),p.Nb()),2&t){const t=n.$implicit;p.zb(1),p.ac("routerLink",p.cc(2,v,t.id)),p.zb(1),p.lc(t.name)}}function N(t,n){if(1&t&&(p.Ob(0,"div"),p.ic(1,w,3,4,"li",5),p.Nb()),2&t){const t=p.Xb().ngIf,n=p.Xb();p.zb(1),p.ac("ngForOf",t.posts)("ngForTrackBy",n.trackByFn)}}function L(t,n){1&t&&(p.Ob(0,"p",7),p.kc(1,"No posts :("),p.Nb())}function z(t,n){if(1&t&&(p.Ob(0,"section",1),p.ic(1,k,2,0,"small",2),p.ic(2,N,2,2,"div",3),p.ic(3,L,2,0,"ng-template",null,4,p.jc),p.Nb()),2&t){const t=n.ngIf,e=p.ec(4);p.zb(1),p.ac("ngIf",t.isLoading),p.zb(1),p.ac("ngIf",null==t.posts?null:t.posts.length)("ngIfElse",e)}}let X=(()=>{class t{constructor(){this.postsQuery$=P(void 0,{selectFromResult:({data:t,isLoading:n})=>({posts:t,isLoading:n})})}trackByFn(t,n){return n.id}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=p.Db({type:t,selectors:[["app-posts-list"]],decls:2,vars:3,consts:[["class","space-y-4",4,"ngIf"],[1,"space-y-4"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["noPosts",""],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"hover:underline",3,"routerLink"],[1,"mt-4"]],template:function(t,n){1&t&&(p.ic(0,z,5,3,"section",0),p.Yb(1,"async")),2&t&&p.ac("ngIf",p.Zb(1,1,n.postsQuery$))},directives:[s.k,s.j,i.i],pipes:[s.b],encapsulation:2,changeDetection:0}),t})();function j(t,n){if(1&t){const t=p.Pb();p.Ob(0,"button",4),p.Vb("click",function(){return p.fc(t),p.Xb().addNewPost()}),p.kc(1),p.Nb()}if(2&t){const t=n.ngIf,e=p.Xb();p.ac("disabled",e.postNameFormControl.invalid||t.isLoading),p.zb(1),p.mc(" ",t.isLoading?"Adding...":"Add Post"," ")}}let x=(()=>{class t{constructor(){this.addPost=m(),this.postNameFormControl=new o.b("",[o.j.required])}addNewPost(){this.addPost.dispatch({name:this.postNameFormControl.value})}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=p.Db({type:t,selectors:[["app-posts-manager"]],decls:12,vars:4,consts:[[1,"space-y-4"],["id","name","placeholder","New post name","type","text",3,"formControl"],["class","m-4 btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"text-xl","font-semibold"],[1,"m-4","btn","btn-primary",3,"disabled","click"]],template:function(t,n){1&t&&(p.Ob(0,"section",0),p.Ob(1,"div"),p.Kb(2,"input",1),p.ic(3,j,2,2,"button",2),p.Yb(4,"async"),p.Nb(),p.Ob(5,"h1",3),p.kc(6,"Posts List"),p.Nb(),p.Kb(7,"app-posts-list"),p.Kb(8,"hr"),p.Ob(9,"h1",3),p.kc(10,"Posts List with duplicate subscription"),p.Nb(),p.Kb(11,"app-posts-list"),p.Nb()),2&t&&(p.zb(2),p.ac("formControl",n.postNameFormControl),p.zb(1),p.ac("ngIf",p.Zb(4,2,n.addPost.state$)))},directives:[o.a,o.e,o.c,s.k,X],pipes:[s.b],encapsulation:2,changeDetection:0}),t})();var F=e("lJxs"),E=e("vkgz");function C(t,n){1&t&&(p.Ob(0,"small"),p.kc(1,"Loading..."),p.Nb())}function M(t,n){if(1&t){const t=p.Pb();p.Ob(0,"button",10),p.Vb("click",function(){return p.fc(t),p.Xb(4).toggleEdit()}),p.kc(1),p.Nb()}if(2&t){const t=n.ngIf,e=p.Xb().ngIf,s=p.Xb(2).ngIf;p.ac("disabled",s.isLoading||e.isLoading||t.isLoading),p.zb(1),p.mc(" ",null!=t&&t.isLoading?"Updating...":"Edit"," ")}}function $(t,n){if(1&t){const t=p.Pb();p.Ob(0,"div",8),p.ic(1,M,2,2,"button",9),p.Yb(2,"async"),p.Ob(3,"button",10),p.Vb("click",function(){p.fc(t);const n=p.Xb(2).ngIf;return p.Xb().deletePost(n.data)}),p.kc(4),p.Nb(),p.Ob(5,"button",10),p.Vb("click",function(){return p.fc(t),p.Xb(2).ngIf.refetch()}),p.kc(6," Refresh "),p.Nb(),p.Nb()}if(2&t){const t=n.ngIf,e=p.Xb(2).ngIf,s=p.Xb();p.zb(1),p.ac("ngIf",p.Zb(2,4,s.updatePostMutation.state$)),p.zb(2),p.ac("disabled",e.isLoading||t.isLoading),p.zb(1),p.mc(" ",null!=t&&t.isLoading?"Deleting...":"Delete"," "),p.zb(1),p.ac("disabled",e.isFetching)}}function D(t,n){if(1&t&&(p.Mb(0),p.ic(1,$,7,6,"div",7),p.Yb(2,"async"),p.Lb()),2&t){const t=p.Xb(2);p.zb(1),p.ac("ngIf",p.Zb(2,1,t.deletePostMutation.state$))}}function T(t,n){if(1&t){const t=p.Pb();p.Ob(0,"div",12),p.Kb(1,"input",13),p.Ob(2,"button",14),p.Vb("click",function(){p.fc(t);const n=p.Xb(2).ngIf;return p.Xb().updatePost(n.data)}),p.kc(3),p.Nb(),p.Ob(4,"button",14),p.Vb("click",function(){return p.fc(t),p.Xb(3).toggleEdit()}),p.kc(5,"Cancel"),p.Nb(),p.Nb()}if(2&t){const t=n.ngIf,e=p.Xb(3);p.zb(1),p.ac("formControl",e.postFormControl),p.zb(1),p.ac("disabled",t.isLoading),p.zb(1),p.mc(" ",null!=t&&t.isLoading?"Updating...":"Update"," "),p.zb(1),p.ac("disabled",t.isLoading)}}function q(t,n){if(1&t&&(p.ic(0,T,6,4,"div",11),p.Yb(1,"async")),2&t){const t=p.Xb(2);p.ac("ngIf",p.Zb(1,1,t.updatePostMutation.state$))}}function R(t,n){if(1&t&&(p.Ob(0,"section",1),p.Ob(1,"div"),p.Ob(2,"h1",2),p.kc(3),p.Nb(),p.ic(4,C,2,0,"small",3),p.Nb(),p.ic(5,D,3,3,"ng-container",4),p.ic(6,q,2,3,"ng-template",null,5,p.jc),p.Ob(8,"pre",6),p.kc(9),p.Yb(10,"json"),p.Nb(),p.Nb()),2&t){const t=n.ngIf,e=p.ec(7),s=p.Xb();p.zb(3),p.lc(null==t||null==t.data?null:t.data.name),p.zb(1),p.ac("ngIf",t.isFetching),p.zb(1),p.ac("ngIf",!s.isEditing)("ngIfElse",e),p.zb(4),p.lc(p.Zb(10,5,t.data))}}const Y=[{path:"",component:x},{path:":id",component:(()=>{class t{constructor(t,n){this.route=t,this.router=n,this.postQuery$=h(this.route.params.pipe(Object(F.a)(t=>+t.id))).pipe(Object(E.a)(t=>{var n,e;return this.postFormControl.setValue(null!==(e=null===(n=t.data)||void 0===n?void 0:n.name)&&void 0!==e?e:"")})),this.updatePostMutation=I(),this.deletePostMutation=y(),this.postFormControl=new o.b(""),this.isEditing=!1}updatePost({id:t}){this.updatePostMutation.dispatch({id:t,name:this.postFormControl.value}).unwrap().then(()=>this.toggleEdit())}deletePost({id:t}){this.deletePostMutation.dispatch(t).unwrap().then(()=>this.router.navigate(["/posts"])).catch(()=>console.log("Error deleting Post"))}toggleEdit(){this.isEditing=!this.isEditing}}return t.\u0275fac=function(n){return new(n||t)(p.Jb(i.a),p.Jb(i.g))},t.\u0275cmp=p.Db({type:t,selectors:[["app-post-detail"]],decls:2,vars:3,consts:[["class","space-y-4",4,"ngIf"],[1,"space-y-4"],[1,"text-xl","font-semibold"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["editionSection",""],[1,"bg-gray-200"],["class","flex items-center space-x-4",4,"ngIf"],[1,"flex","items-center","space-x-4"],["class","btn-outline btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn-outline","btn-primary",3,"disabled","click"],["class","space-x-4",4,"ngIf"],[1,"space-x-4"],["type","text",3,"formControl"],[1,"btn","btn-primary",3,"disabled","click"]],template:function(t,n){1&t&&(p.ic(0,R,11,7,"section",0),p.Yb(1,"async")),2&t&&p.ac("ngIf",p.Zb(1,1,n.postQuery$))},directives:[s.k,o.a,o.e,o.c],pipes:[s.b,s.f],encapsulation:2,changeDetection:0}),t})()}];let Q=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=p.Hb({type:t}),t.\u0275inj=p.Gb({imports:[[i.j.forChild(Y)],i.j]}),t})(),S=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=p.Hb({type:t}),t.\u0275inj=p.Gb({imports:[[s.c,Q,o.d,o.h,O]]}),t})()}}]);